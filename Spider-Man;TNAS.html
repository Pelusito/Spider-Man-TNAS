<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Spider-Man TNAS</title>
  <style>
    body {
      margin: 0;
      background-color: #0d0d0d;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
    }
    h1 {
      text-align: center;
      padding: 25px 10px;
      font-size: 32px;
      font-weight: 600;
      letter-spacing: 1px;
      color: #e50914;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      padding: 15px;
      width: 95%;
      margin: auto;
    }
    .episode-card {
      position: relative;
      cursor: pointer;
      border-radius: 12px;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
      background-color: #1a1a1a;
    }
    .episode-card:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 20px rgba(0,0,0,0.7);
    }
    .thumb {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .ep-number {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,0.7);
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      color: #fff;
    }
    .seen-button {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .seen-button:hover {
      background: rgba(255,255,255,0.2);
    }
    .player {
      width: 95%;
      max-width: 1000px;
      margin: 20px auto;
      display: none;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
    }
    video {
      width: 100%;
      display: block;
      outline: none;
    }
    .close-btn {
      text-align: center;
      margin-bottom: 10px;
      cursor: pointer;
      font-size: 16px;
      background: #e50914;
      width: 110px;
      padding: 6px;
      border-radius: 10px;
      margin-left: auto;
      margin-right: auto;
      font-weight: bold;
    }
    .iframe-wrapper {
      width: 95%;
      height: 60vh;
      max-height: 600px;
      margin: 20px auto;
      display: none;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
    }
    .iframe-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    .center { display:flex; justify-content:center; }

    @media (max-width: 768px) {
      .thumb { height: 180px; }
      .ep-number { font-size: 12px; padding: 3px 6px; }
      .seen-button { font-size: 11px; padding: 3px 6px; }
      h1 { font-size: 28px; padding: 20px 10px; }
      .iframe-wrapper { height: 50vh; }
    }

    @media (max-width: 480px) {
      .thumb { height: 150px; }
      .ep-number { font-size: 11px; padding: 2px 5px; }
      .seen-button { font-size: 10px; padding: 2px 5px; }
      h1 { font-size: 24px; padding: 15px 5px; }
      .iframe-wrapper { height: 45vh; }
    }
  </style>
</head>
<body>

<h1>Spider-Man TNAS</h1>

<div id="episodes" class="grid"></div>

<div id="playerBox" class="player">
  <div class="close-btn" onclick="closePlayer()">Cerrar</div>
  <video id="videoPlayer" controls crossorigin="anonymous" webkit-playsinline playsinline></video>
</div>

<div id="iframeBox" class="iframe-wrapper">
  <div class="center"><div class="close-btn" onclick="closeIframe()">Cerrar</div></div>
  <iframe id="driveIframe" allowfullscreen allow="autoplay; fullscreen; encrypted-media" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
</div>

<script>
  const episodes = [
    "1GuuSxWdAeAEWs3RGyGjJckP7tPb9bUxz",
    "1NkK1wbZj3bGPbnWllNBoltNF9f7Yjbku",
    "1z-jKRNHy2P3ms_dLVI2A5kZgsA-meUMF",
    "1cNXY7TPYTuHOS7QY48Iu2V1c3w4bhMJK",
    "13PhrhiMwFEo3UlnWNe93UlUlzr3uDfMB"
  ];

  const episodesDiv = document.getElementById("episodes");

  episodes.forEach((id, index) => {
    const epNum = index + 1;
    const card = document.createElement("div");
    card.className = "episode-card";

    const img = document.createElement("img");
    img.src = "https://i.imgur.com/pX580AO.jpeg";
    img.className = "thumb";

    const number = document.createElement("div");
    number.className = "ep-number";
    number.textContent = epNum;

    const seenButton = document.createElement("div");
    seenButton.className = "seen-button";
    seenButton.textContent = localStorage.getItem("ep" + epNum) === "1" ? "Visto" : "No visto";
    seenButton.onclick = (e) => {
      e.stopPropagation();
      const current = localStorage.getItem("ep" + epNum) === "1";
      localStorage.setItem("ep" + epNum, current ? "0" : "1");
      seenButton.textContent = current ? "No visto" : "Visto";
    };

    card.onclick = () => openPlayer(id);

    card.appendChild(img);
    card.appendChild(number);
    card.appendChild(seenButton);
    episodesDiv.appendChild(card);
  });

  async function openPlayer(id) {
    const downloadUrl = `https://drive.google.com/uc?export=download&id=${id}`;
    const previewUrl = `https://drive.google.com/file/d/${id}/preview`;

    const playerBox = document.getElementById("playerBox");
    const video = document.getElementById("videoPlayer");
    const iframeBox = document.getElementById("iframeBox");
    const driveIframe = document.getElementById("driveIframe");

    playerBox.style.display = "block";
    iframeBox.style.display = "none";
    video.src = "";

    try {
      const res = await fetch(downloadUrl);
      if (!res.ok) throw new Error('fetch-no-ok');
      const contentType = res.headers.get('Content-Type') || '';
      if (!contentType.startsWith('video/')) throw new Error('not-video');
      const blob = await res.blob();
      const objectUrl = URL.createObjectURL(blob);
      video.src = objectUrl;
      video.play().catch(()=>{});
      video.onended = () => { URL.revokeObjectURL(objectUrl); };
    } catch (err) {
      playerBox.style.display = "none";
      driveIframe.src = previewUrl;
      iframeBox.style.display = "block";
    }
  }

  function closePlayer() {
    const playerBox = document.getElementById("playerBox");
    const video = document.getElementById("videoPlayer");
    video.pause();
    try { if (video.src.startsWith('blob:')) URL.revokeObjectURL(video.src); } catch(e){}
    video.src = "";
    playerBox.style.display = "none";
  }

  function closeIframe() {
    const iframeBox = document.getElementById("iframeBox");
    const driveIframe = document.getElementById("driveIframe");
    driveIframe.src = "";
    iframeBox.style.display = "none";
  }
</script>

</body>
</html>
